<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/rnds/blog/rss.xml" title="RNDS Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rnds/blog/atom.xml" title="RNDS Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="RNDS" href="/rnds/opensearch.xml"><title data-react-helmet="true">Conector | RNDS</title><meta data-react-helmet="true" property="og:url" content="https://kyriosdata.github.io/rnds/docs/conector"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Conector | RNDS"><meta data-react-helmet="true" name="description" content="Conector √© o nome dado √† solu√ß√£o tecnol√≥gica que acessa a RNDS. √â este software que precisa ser desenvolvido pelo integrador e, de fato, o que implementa a troca de informa√ß√£o em sa√∫de com a RNDS."><meta data-react-helmet="true" property="og:description" content="Conector √© o nome dado √† solu√ß√£o tecnol√≥gica que acessa a RNDS. √â este software que precisa ser desenvolvido pelo integrador e, de fato, o que implementa a troca de informa√ß√£o em sa√∫de com a RNDS."><link data-react-helmet="true" rel="shortcut icon" href="/rnds/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kyriosdata.github.io/rnds/docs/conector"><link data-react-helmet="true" rel="alternate" href="https://kyriosdata.github.io/rnds/docs/conector" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://kyriosdata.github.io/rnds/docs/conector" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/rnds/assets/css/styles.3a9bf66c.css">
<link rel="preload" href="/rnds/assets/js/runtime~main.3303b8a6.js" as="script">
<link rel="preload" href="/rnds/assets/js/main.feafc91e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rnds/"><b class="navbar__title">Guia</b></a><a class="navbar__item navbar__link" href="/rnds/docs/rel/objetivo-rel">Modelos</a><a class="navbar__item navbar__link" href="/rnds/docs/introducao">Contexto</a><a href="https://servicos-datasus.saude.gov.br/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Portal de Servi√ßos</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/rnds/"><b class="navbar__title">Guia</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/rnds/docs/rel/objetivo-rel">Modelos</a></li><li class="menu__list-item"><a class="menu__link" href="/rnds/docs/introducao">Contexto</a></li><li class="menu__list-item"><a href="https://servicos-datasus.saude.gov.br/" target="_blank" rel="noopener noreferrer" class="menu__link">Portal de Servi√ßos</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/rnds/docs/introducao">Introdu√ß√£o</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/rnds/docs/conector">Conector</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">P√∫blico-alvo</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/publico-alvo">Quem?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Gestor</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/gestor/gestor">Atribui√ß√µes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/gestor/certificado">Certificado digital</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/gestor/gov.br">Criar conta gov.br</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/gestor/portal">Solicitar acesso</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/gestor/identificador">Identificador do solicitante</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Integrador</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/ti/ti">Atribui√ß√µes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/ti/conhecer">Conhe√ßa os servi√ßos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/ti/homologar">Homologar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/ti/producao">Colocar em produ√ß√£o</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/ti/requisicoes">Requisi√ß√µes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/ti/erros">Erros</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/publico-alvo/ti/autenticacao">Autentica√ß√£o Java</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/rnds/docs/passo-a-passo">Passo a passo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">RNDS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/padrao">Padr√£o</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/ambientes">Ambientes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/servicos">Servi√ßos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/definicoes">Defini√ß√µes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/tecnologias">Ecossistema FHIR</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Ferramentas</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/tools/api">RNDS API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/tools/bibliotecas">Bibliotecas</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/tools/fhirpath">FHIRPath</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/tools/keytool">keytool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/tools/validacao">Valida√ß√£o</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rnds/docs/rnds/tools/fhirserver">Servidor FHIR</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/rnds/docs/faq">Perguntas &amp; Respostas</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Conector</h1></header><p>Conector √© o nome dado √† solu√ß√£o tecnol√≥gica que acessa a RNDS. √â este software que precisa ser desenvolvido pelo integrador e, de fato, o que implementa a troca de informa√ß√£o em sa√∫de com a RNDS.</p><p>Atribuir fun√ß√µes e discutir aspectos de <em>design</em> e de implementa√ß√£o do software de integra√ß√£o com a RNDS, aqui denominado de Conector, atende o prop√≥sito de orientar integradores acerca de quest√µes t√©cnicas pertinentes √† integra√ß√£o com a RNDS.</p><p>Este conte√∫do n√£o √© prescritivo.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sistema-de-informa√ß√£o-em-sa√∫de-sis"></a>Sistema de Informa√ß√£o em Sa√∫de (SIS)<a class="hash-link" href="#sistema-de-informa√ß√£o-em-sa√∫de-sis" title="Direct link to heading">#</a></h2><p>Um estabelecimento de sa√∫de usa, em geral, um Sistema de Informa√ß√£o em Sa√∫de (SIS) para auxiliar na gest√£o das suas demandas, usu√°rios, profissionais de sa√∫de, procedimentos e outros. Tal sistema est√° ou n√£o integrado √† RNDS, o que √© ilustrado pelos
cen√°rios abaixo.</p><p><img alt="img" src="/rnds/assets/images/cenarios-9844131e1f337994115f112e4ca00e26.png"></p><p>Adicionalmente, pode-se representar abstratamente qualquer SIS como a uni√£o de dois componentes: (a) um Banco de Dados, no qual informa√ß√µes administrativas e outras de sa√∫de s√£o armazenadas; e (b) o software propriamente dito do SIS.</p><p>Esta organiza√ß√£o abstrada de um SIS em apenas dois componetes √© √∫til para identificar o que √© denominado de Conector, o que √© feito abaixo por meio dos dois cen√°rios ilustrados acima.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sem-integra√ß√£o"></a>Sem integra√ß√£o<a class="hash-link" href="#sem-integra√ß√£o" title="Direct link to heading">#</a></h3><p>Usando esta abstra√ß√£o, quando n√£o h√° interoperabilidade do SIS com outro sistema, n√£o h√° software de integra√ß√£o, n√£o h√° Conector e, consequentemente, n√£o h√° integra√ß√£o com a RNDS, conforme ilustrado abaixo.</p><p><img alt="img" src="/rnds/assets/images/rnds-m0-c8a4d85968e74b306ce21426e7bd8f59.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="com-integra√ß√£o"></a>Com integra√ß√£o<a class="hash-link" href="#com-integra√ß√£o" title="Direct link to heading">#</a></h3><p>A integra√ß√£o exige a exist√™ncia do Conector.
A implementa√ß√£o das fun√ß√µes deste software pode assumir v√°rias formas. Duas delas s√£o apresentadas abaixo.</p><p>Na primeira, o SIS empregado pelo estabelecimento de sa√∫de passa por uma manuten√ß√£o na qual as fun√ß√µes do Conector s√£o fundidas ao SIS existente. O SIS, agora modificado, torna-se um SIS que interage com a RNDS, um SIS integrado √† RNDS.</p><p><img alt="img" src="/rnds/assets/images/rnds-m1-e19e25d72401182dc7c556e3c4c39b64.png"></p><p>Na segunda, um componente espec√≠fico re√∫ne e isola as fun√ß√µes necess√°rias para a integra√ß√£o com a RNDS, diferente do cen√°rio anterior. Neste caso, √© poss√≠vel que o Conector seja encarregado de obter as informa√ß√µes em sa√∫de a serem transferidas, possivelmente acessando diretamente o Banco de Dados do estabelecimento de sa√∫de.</p><p><img alt="img" src="/rnds/assets/images/rnds-m2-2661ffa2db54833a49857e1e16e127fc.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="design-do-conector-sem-restri√ß√µes"></a><em>Design</em> do Conector (sem restri√ß√µes?)<a class="hash-link" href="#design-do-conector-sem-restri√ß√µes" title="Direct link to heading">#</a></h3><p>Conv√©m esclarecer que estas duas formas de integra√ß√£o n√£o s√£o as √∫nicas, e que a RNDS n√£o imp√µe exig√™ncias na organiza√ß√£o do SIS em quest√£o. De fato, nem sequer h√° uma sugest√£o de <em>design</em> para o Conector, pois isto depende de in√∫meras vari√°veis espec√≠ficas de cada estabelecimento de sa√∫de e, consequentemente, √© assunto interno de cada estabelecimento.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conector-de-refer√™ncia"></a>Conector de refer√™ncia<a class="hash-link" href="#conector-de-refer√™ncia" title="Direct link to heading">#</a></h2><p>Tendo em vista as especificidades de cada integra√ß√£o, √∫nica por estabelecimento de sa√∫de, n√£o √© fact√≠vel definir uma an√°lise e um <em>design</em> adequados para todos eles. O que segue, portanto, √© uma investiga√ß√£o preliminar com o objetivo de oferecer uma orienta√ß√£o para integradores. A estrat√©gia √© familiarizar o integrador com quest√µes naturais da integra√ß√£o com a RNDS.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="escopo"></a>Escopo<a class="hash-link" href="#escopo" title="Direct link to heading">#</a></h3><p>O Conector, como qualquer outro software, visa atender alguma demanda. Para o Conector de refer√™ncia a demanda (escopo) √© a Portaria 1.792, que determina a obrigatoriedade de notifica√ß√£o de resultados de exame da COVID-19. Conv√©m observar que a notifica√ß√£o de laudo de COVID-19 √© a primeira necessidade de troca de informa√ß√£o contemplada pela RNDS.</p><p>Ao longo do tempo, outras necessidades ser√£o inclu√≠das, como a notifica√ß√£o do Sum√°rio de Alta (SA) e do Registro de Atendimento Cl√≠nico (RAC), por exemplo. Cada necessidade √© detalhada tanto pelo modelo de informa√ß√£o quanto pelo modelo computacional, o que viabiliza a integra√ß√£o com a RNDS para a necessidade em quest√£o.</p><p>Naturalmente, √† medida que novas necessidades de integra√ß√£o forem implementadas pela RNDS, mais informa√ß√µes em sa√∫de e outros tipos de estabelecimentos de sa√∫de estar√£o envolvidos.</p><p><img alt="img" src="/rnds/assets/images/rnds-percurso-a54edb82e15fa3898b12751b4431e759.png"></p><p>Apesar do Conector de refer√™ncia atender uma necessidade espec√≠fica (notificar laudos de COVID-19), a discuss√£o do mesmo permanece relevante para outras demandas.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="requisitos"></a>Requisitos<a class="hash-link" href="#requisitos" title="Direct link to heading">#</a></h2><p>Os requisitos s√£o apresentados em duas perspectivas: uma de fluxo de dados e outra de casos de uso. O objetivo √© contribuir com a compreens√£o das fun√ß√µes a serem implementadas pelo Conector. S√£o, portanto, duas vis√µes distintas das mesmas atribui√ß√µes do Conector.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fluxo-de-dados"></a>Fluxo de dados<a class="hash-link" href="#fluxo-de-dados" title="Direct link to heading">#</a></h3><p>A notifica√ß√£o de exame de COVID-19 √© ilustrada abaixo na perspectiva de processos (fun√ß√µes) e do fluxo de informa√ß√µes entre eles. Aqueles processos coloridos s√£o &quot;gen√©ricos&quot;, enquanto os demais dependem diretamente do SIS para o qual o Conector √© criado.</p><p><img alt="img" src="/rnds/assets/images/rnds-dfd-65b559a17aeb27622bfb54fb86950da4.png"></p><p>Cada uma das fun√ß√µes acima s√£o comentadas abaixo. Dependendo do SIS em quest√£o, contudo, algumas delas podem n√£o ser
necess√°rias. Por exemplo, se um dado SIS j√° guarda informa√ß√µes sobre cada resultado de exame em documento XML pr√≥prio, ent√£o n√£o ser√° necess√°rio coletar informa√ß√µes dispersas, filtrar e talvez nem tampouco efetuar algum mapeamento.</p><ul><li><p><strong>Filtrar dados</strong>. Seleciona os dados de um resultado de exame contendo o que √© necess√°rio para o envio. Consome informa√ß√µes registradas no dep√≥sito de dados do laborat√≥rio.</p></li><li><p><strong>Mapear dados</strong>. Realiza a convers√£o e/ou mapeamento, se for o caso, entre o que √© recuperado (fun√ß√£o acima) e o formato exigido pela RNDS. Por exemplo, a data &quot;01/01/21&quot; √©
mapeada para &quot;01/01/2021&quot;.</p></li><li><p><strong>Criar inst√¢ncia de recurso</strong>. Os dados j√° filtrados e mapeados empregam uma estrutura de dados que precisa ser representada em JSON, em conformidade com o recurso FHIR (<em>resource</em>) pertinente.</p></li><li><p><strong>Montar bundle</strong>. Empacota os recursos pertinentes na representa√ß√£o JSON de um <em>Bundle</em> (um dos recursos FHIR).
Quando executada, esta fun√ß√£o tamb√©m pode realizar a
verifica√ß√£o da representa√ß√£o resultante. Ou seja, assegurar
que foi criada conforme esperado pela RNDS.</p></li><li><p><strong>Obter token</strong>. Obt√©m <em>token</em> do <em>web service</em> de seguran√ßa da RNDS para acesso aos demais servi√ßos, inclusive aquele pelo qual a notifica√ß√£o de exame √© realizada.</p></li><li><p><strong>Submeter requisi√ß√£o</strong>. Notifica o resultado de um exame √† RNDS. Esta √© a fun√ß√£o que, de fato, realiza o envio desejado, faz uso de um <em>web service</em> distinto daquele de seguran√ßa, empregado para obter o <em>token</em> de acesso.</p></li></ul><p>A figura abaixo ilustra os processos executados em uma sequ√™ncia t√≠pica, al√©m do <em>web service</em> de seguran√ßa e daqueles de sa√∫de oferecidos pela RNDS, identificados respectivamente por <em>Auth</em> e <em>EHR</em>. Em tempo, tais servi√ßos s√£o oferecidos pelos <a href="/rnds/docs/rnds/ambientes">ambientes</a> da RNDS.</p><p><img alt="img" src="/rnds/assets/images/desenvolvedor-9a5d747dfa95143512fe6021317e9e23.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="casos-de-uso"></a>Casos de uso<a class="hash-link" href="#casos-de-uso" title="Direct link to heading">#</a></h3><p>A integra√ß√£o exige a intera√ß√£o entre um estabelecimento de sa√∫de e a RNDS. As intera√ß√µes relevantes para a notifica√ß√£o de exame de COVID-19 s√£o ilustradas abaixo por meio de casos de uso: (a) <em>Obter token de acesso</em>; (b) <em>Montar payload para resultado de COVID</em> e (c) <em>Enviar resultado de COVID</em>.</p><p><img alt="img" src="/rnds/assets/images/conector-uc-8023c7d4b058e421cd85928edbcb8327.png"></p><p>Uma integra√ß√£o pode demandar outras atividades a serem contempladas pelo Conector. Por exemplo, responder se um determinado resultado foi submetido satisfatoriamente ou n√£o, e recuperar a resposta da RNDS para uma dada notifica√ß√£o entregue, dentre outras. Estas e outras atividades podem ser necess√°rias, mas n√£o s√£o espec√≠ficas da integra√ß√£o com a RNDS. Em consequ√™ncia, apenas os casos de uso citados acima s√£o considerados doravante.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Nota</h5></div><div class="admonition-content"><p>Compreender estes casos de uso significa compreender o que √© relevante para qualquer integra√ß√£o com a RNDS, e n√£o apenas para a notifica√ß√£o de resultado do COVID-19. Eles representam a seguran√ßa e uma necessidade t√≠pica de interoperabilidade em sa√∫de.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="obter-token-de-acesso"></a>Obter token de acesso<a class="hash-link" href="#obter-token-de-acesso" title="Direct link to heading">#</a></h3><p>A obten√ß√£o de um <em>token</em> de acesso √© obrigat√≥ria e visa contemplar aspectos de seguran√ßa. O <em>token</em> √© obtido por meio de <em>web service</em> espec√≠fico, e o valor recuperado ser√° exigido em todas as requi√ß√µes endere√ßadas aos demais <em>web services</em> oferecidos pela RNDS.</p><p>Esta atividade √© realizada por meio de uma requisi√ß√£o <em>https</em>, m√©todo GET, endere√ßada ao <em>web service</em> de autentica√ß√£o. Este servi√ßo √© identificado por <em>Auth</em>, na documenta√ß√£o dos <a href="/rnds/docs/rnds/ambientes">ambientes</a> s√£o fornecidos detalhes, inclusive o endere√ßo onde est√° dispon√≠vel. Esta requisi√ß√£o depende do certificado digital associado ao estabelecimento de sa√∫de em quest√£o.</p><p>Observe que o certificado digital √© associado ao estabelecimento de sa√∫de pelo gestor, durante a solicita√ß√£o de acesso √† RNDS. Consulte os passos do <a href="/rnds/docs/passo-a-passo">credenciamento</a> para detalhes.</p><p>Uma requisi√ß√£o satisfat√≥ria dever√° retornar o c√≥digo HTTP 200, e o corpo
da resposta ter√° o seguinte formato ilustrado abaixo. O principal valor √© aquele
para a chave <code>access_token</code>, uma &quot;longa&quot; sequ√™ncia de caracteres que, no exemplo abaixo, foi substitu√≠da por texto explicativo.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;access_token&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;token (longa sequ√™ncia de carateres)&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;scope&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;read write&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;token_type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;jwt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;expires_in&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1800000</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A resposta acima indica que o <em>token</em> tem validade de 30min, ou 1.800.000ms, e que idealmente deve ser reutilizado, neste per√≠odo, ou seja, estabelece uma expectativa a ser honrada pelo Conector.</p><p>Noutras palavras, o Conector deve realizar uma requisi√ß√£o para obter o <em>token</em> de acesso, guardar o valor recebido e reutiliz√°-lo, at√© que seja substitu√≠do por uma nova requisi√ß√£o, cerca de 30 minutos depois.</p><p>Durante o per√≠odo de validade muitas requisi√ß√µes aos <em>web services</em> da RNDS possivelmente ser√£o feitas usando um mesmo valor de <em>token</em>, obtido de uma √∫nica requisi√ß√£o para o <em>web service</em> de seguran√ßa.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="montar-payload-para-resultado-de-covid"></a>Montar payload para resultado de COVID<a class="hash-link" href="#montar-payload-para-resultado-de-covid" title="Direct link to heading">#</a></h3><p>Um resultado de COVID-19 deve ser montado conforme
os perfis definidos por modelos computacionais, para que possa ser compreendido pela RNDS. Este caso de uso caracteriza esta funcionalidade.</p><p>A montagem √© realizada por quatro processos identificados anteriormente: (a) filtrar dados; (b) mapear dados; (c) criar inst√¢ncia e (d) montar bundle. Estes processos, executados nesta ordem, devem produzir um <em>Bundle</em>, o <em>payload</em> a ser submetido, os dados correspondente a um resultado de exame laboratorial no formato esperado pela RNDS. O <a href="/rnds/docs/rel/mc-rel">modelo computacional</a> detalha exaustivamente o formato a ser utilizado para enviar um resltado.</p><p>Este caso de uso, portanto, re√∫ne processos que visam converter um resultado de exame laboratorial, qualquer que seja o formato empregado pelo estabelecimento de sa√∫de em quest√£o, em vers√£o equivalente no formato esperado pela RNDS.</p><p>A filtragem dos dados exige conhecer o formato de dados empregado pelo SIS do estabelecimento de sa√∫de em quest√£o (entrada) e o que deve ser enviado para a RNDS (sa√≠da), o que exige o conhecimento do <a href="/rnds/docs/rel/mi-rel">modelo de informa√ß√£o</a>.</p><p>O processo de mapeamento realiza alguma transforma√ß√£o necess√°ria entre formatos de dados.</p><p>A cria√ß√£o de inst√¢ncia de recurso exige o conhecimento do recurso FHIR empregado e, em particular, de eventuais perfis que estabelecem restri√ß√µes a serem observadas.</p><p>Por √∫ltimo, o <em>Bundle</em> empacota os recursos criados no processo anterior, j√° serializados em JSON, em JSON resultante, o <em>payload</em>
do resultado de COVID a ser enviado.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="enviar-resultado-de-covid"></a>Enviar resultado de COVID<a class="hash-link" href="#enviar-resultado-de-covid" title="Direct link to heading">#</a></h3><p>Cria uma requisi√ß√£o <em>https</em> e a submete √† RNDS.</p><p>O caso de uso <em>Montar payload para resultado de COVID</em> define o que √© necess√°rio para produzir o conte√∫do a ser enviado. De posse do <em>payload</em> a requisi√ß√£o ainda depende da URL e de <em>headers</em>.</p><p>A URL segue o formato <code>htts://{{endereco}}/api/fhir/r4/Bundle</code>.</p><p>Observe que <code>{{endereco}}</code> √© substitu√≠do conforme o ambiente empregado. Por exemplo, para acesso ao ambiente de homologa√ß√£o o endere√ßo √©
<strong>ehr-auth-hmg.saude.gov.br</strong>. Consulte <a href="/rnds/docs/rnds/ambientes">ambientes</a> para detalhes.</p><p>Dois <em>headers</em> devem ser fornecidos: <code>X-Athorization-Server</code> e <code>Authorization</code>. O primeiro √© definido pela concatena√ß√£o de &quot;Bearer &quot; com o valor do <em>token</em> de acesso. Consulte <em>Obter token de acesso</em> para detalhes de como obter o valor do <em>token</em>. O segundo √© o CNS do
profissional de sa√∫de em nome do qual a requisi√ß√£o √© feita. Necessariamente deve ser um profissional de sa√∫de lotado no estabelecimento de sa√∫de em quest√£o.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>o Dica</h5></div><div class="admonition-content"><p>O postman √© uma ferramenta empregada para experimentar <em>web services</em> e h√° uma <em>collection</em> (cofigura√ß√£o) pronta para experimentar o que a RNDS oferece.
Veja <a href="/rnds/docs/publico-alvo/ti/conhecer">aqui</a>.</p></div></div><p>A resposta de c√≥digo HTTP 200 indica que a requisi√ß√£o foi executada satisfatoriamente. Neste caso, dentre os <em>headers</em> retornados est√° <code>Location</code>, que informa o identificador √∫nico atribu√≠do pela RNDS ao resultado de exame submetido.</p><p>Este caso de uso observa uma sequ√™ncia comum √†s requisi√ß√µes enviadas aos <em>web services</em> da RNDS:</p><ol><li>Obter o <em>token</em> de acesso, possivelmente de <em>cache</em>. Consultar caso de uso <em>Obter token de acesso</em>.</li><li>Montar valor para <code>X-Authorization-Server</code>. Concatenar &quot;Bearer &quot; (observe o espa√ßo em branco) com o valor do <em>token</em> de acesso (passo anterior).</li><li>Definir valor para <code>Authorization</code>. Recuperar o CNS do profissional de sa√∫de do estabelecimento em quest√£o, em nome do qual a requisi√ß√£o ser√° submetida.</li><li>Montar a requisi√ß√£o. Isto exige o endere√ßo e o <em>path</em> para a montagem da URL correspondente. Tamb√©m √© poss√≠vel a exist√™ncia de par√¢metros. A sugest√£o aqui √© consultar URLs prontas para as requisi√ß√µes oferecidas pela RNDS (<a href="/rnds/docs/publico-alvo/ti/conhecer">aqui</a>).</li><li>Submeter a requisi√ß√£o.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="design"></a>Design<a class="hash-link" href="#design" title="Direct link to heading">#</a></h2><p>Os requisitos atribu√≠dos ao Conector podem ser realizadas de v√°rias maneiras. Abaixo segue apenas um poss√≠vel <em>design</em>, dado que n√£o s√£o fornecidos detalhes de uma integra√ß√£o espec√≠fica. Noutras palavras, seguramente n√£o √© aplic√°vel a todos os estabelecimento de sa√∫de. Por outro lado, √© relevante compreend√™-lo como parte da forma√ß√£o de um integrador.</p><p>Nesta poss√≠vel solu√ß√£o o Conector √© implementado por um microsservi√ßo acionado por evento.</p><blockquote><p>IMPORTANTE: o emprego de um
microsservi√ßo visa ilustrar como o Conector pode ser
implementado, e n√£o se confunde com uma recomenda√ß√£o.</p></blockquote><p>O evento sinaliza a gera√ß√£o de um laudo de exame, conforme ilustrado abaixo. Dessa forma, o SIS √© modificado para gerar um evento, quando um laudo √© registrado, e o microsservi√ßo (Conector), ao receb√™-lo, notifica o Minist√©rio da Sa√∫de por meio da RNDS.</p><p><img alt="img" src="/rnds/assets/images/rnds-m3-2068260764a8e528e9f07eeabe85a72b.png"></p><p>O Conector est√° isolado do restante do SIS, √© um microsservi√ßo. O <em>design</em> do
c√≥digo deste microsservi√ßo pode ser influenciado por v√°rios fatores, quest√£o j√° levantada anteriormente, isto inclui at√© mesmo a forma√ß√£o do integrador e a expectativa de qualidade para o Conector, por exemplo, dentre muitos outros. Ou seja, √© natural existirem alternativas para o que segue, principalmente na aus√™ncia de requisitos de um cen√°rio real.</p><p>Considera√ß√µes feitas, o <em>design</em> visa privilegiar a legibilidade e
a manutenibilidade. Um esbo√ßo inicial √© apresentado, refinado e a vers√£o resultante apresentada na sequ√™ncia, por meio das
se√ß√µes seguintes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="esbo√ßo-inicial"></a>Esbo√ßo inicial<a class="hash-link" href="#esbo√ßo-inicial" title="Direct link to heading">#</a></h3><p>Em um primeiro esfor√ßo foram identificadas as classes abaixo ap√≥s uma leitura criteriosa dos casos de uso. Aquelas n√£o coloridas realizam as fun√ß√µes do neg√≥cio, enquanto as demais oferecem o suporte necess√°rio.</p><p><img alt="img" src="/rnds/assets/images/conector-domain-v0-de2924ddb5e16c2cab25501a5d9f23ac.png"></p><p>A classe <code>Conector</code> encapsula a conex√£o do SIS com o microsservi√ßo (n√£o confunda com a conex√£o do Conector com a RNDS). Desta forma,
a implementa√ß√£o correspondente, por exemplo, se uma requisi√ß√£o <em>https</em> ou o envio
de uma mensagem por meio de <a href="https://activemq.apache.org/" target="_blank" rel="noopener noreferrer">ActiveMQ</a> (<em>message broker</em>) ou <a href="https://aws.amazon.com/sns/" target="_blank" rel="noopener noreferrer">SNS</a>, fica encapsulada nesta classe.
Em consequ√™ncia, o c√≥digo que faz uso desta classe executa uma simples mensagem como
<code>Conector.notifique(resultado)</code>, por exemplo.</p><p>Este microsservi√ßo deve possuir o seu pr√≥prio reposit√≥rio onde s√£o registradas as
requisi√ß√µes recebidas para serem notificadas (eventos) e as respostas obtidas das submiss√µes. Cada submiss√£o re√∫ne o que √© submetido, al√©m do <code>Resultado</code> de um exame e da resposta apresentada pela RNDS. A resposta inclui o identificadr √∫nico, atribu√≠do pela RNDS, ao resultado de exame. Talvez um nome melhor para o reposit√≥rio seja <code>ConectorRepositry</code>, em vez de <code>ResultadoRepository</code>.</p><p>O envio propriamente dito de informa√ß√£o para a RNDS est√° encapsulada na classe <code>RNDSProxy</code>. Este envio depende do <em>token</em> de acesso cuja gest√£o pode estar encapsulada
na classe <code>TokenCache</code>. Naturalmente, estas fun√ß√µes dependem de valores que variam ao
longo do tempo e s√£o obtidos, nesta proposta, pela classe <code>Configuracao</code>. Por exemplo, o certificado digital e a senha correspondente s√£o algumas das informa√ß√µes obtidas por meio desta classe.</p><p>As tr√™s classes comentadas no par√°grafo anterior implementam fun√ß√µes de acesso √† RNDS e, naturalmente, s√£o candidatas naturais para serem reutilizadas. Em consequ√™ncia, ser√£o implementadas em uma biblioteca. A biblioteca <a href="https://www.npmjs.com/package/rnds" target="_blank" rel="noopener noreferrer">rnds</a> √© uma implementa√ß√£o desta decis√£o.</p><p>Dado que as classes <code>Conector</code> e <code>Resultado</code> s√£o empregadas para sinalizar a ocorr√™ncia de um evento (produ√ß√£o de um resultado de exame), o c√≥digo que as emprega n√£o √© executado pelo microsservi√ßo, mas pelo cliente do microsservi√ßo, outra decis√£o √© disponibiliz√°-las em uma outra biblioteca. Esta, ao contr√°rio da anterior, deve ser utilizada pela parte do SIS a ser adaptada. Ou seja, esta investiga√ß√£o inicial resulta em algumas decis√µes e duas bibliotecas.</p><p><img alt="img" src="/rnds/assets/images/conector-bibliotecas-bf741d17a61a01f414f9cd09ef6e318a.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="esbo√ßo-resultante"></a>Esbo√ßo resultante<a class="hash-link" href="#esbo√ßo-resultante" title="Direct link to heading">#</a></h3><p>Visando aprofundar um pouco mais, tratar os processos filtrar, mapear e demais como fun√ß√£o (<a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html" target="_blank" rel="noopener noreferrer">Function</a> em Java) √© um passo natural. Sim, o <em>design</em>, neste caso, sofre influ√™ncia de Java e o alerta foi feito anteriormente pela &quot;aus√™ncia de um cen√°rio real&quot; que definiria restri√ß√µes como a linguagem de programa√ß√£o a ser adotada. Adicionalmente, C# tamb√©m pode ser empregada por meio de <em>delegates</em>. De fato, este <em>design</em> n√£o √© implement√°vel apenas em Java ou C#.</p><p>Ao excluir as classes a serem implementadas nas bibliotecas comentadas anteriormente e introduzirmos detalhes para as fun√ß√µes, obt√©m-se o resultado abaixo. A op√ß√£o de uma classe por fun√ß√£o promove a coes√£o e a independ√™ncia entre elas. A combina√ß√£o destas fun√ß√µes, em uma √∫nica linha, conforme nota na figura, sugere que √© uma alternativa a ser considerada para transformar uma <code>Resposta</code> na representa√ß√£o JSON de um <em>Bundle</em> (recurso FHIR), esperado pela RNDS.</p><p><img alt="img" src="/rnds/assets/images/conector-domain-v1-36743b3f61b34044ae048c1e7f9d643e.png"></p><p>A classe <code>Filtrar</code> implementa a fun√ß√£o de mesmo nome identificada acima. Qualquer
que seja a estrutura e as informa√ß√µes em <code>Resultado</code>, o que √© relevante √© depositado em
um dicion√°rio com chave pertinente, por exemplo, &quot;cns&quot; para o CNS do usu√°rio em quest√£o.</p><p>A classe <code>Mapear</code> realiza eventuais mapeamentos, por exemplo, o valor &quot;positivo&quot; para o c√≥digo correspondente esperado pela RNDS e assim por diante.</p><p>A classe <code>ToJson</code> cria a representa√ß√£o JSON para um recurso FHIR. Um resultado de exame laboratorial de COVID-19 inclui a amostra biol√≥gica utilizada pelo exame. Esta amostra √© definida pelo recurso FHIR <a href="https://www.hl7.org/fhir/specimen.html" target="_blank" rel="noopener noreferrer">Specimen</a>. Em particular, h√° uma adapa√ß√£o nacional para este recurso, o que √© chamado de perfil, neste caso, o perfil <a href="https://simplifier.net/redenacionaldedadosemsaude/BRAmostraBiologica" target="_blank" rel="noopener noreferrer">Amostra Biol√≥gica</a>. Para ilustrar, se a amostra utilizada √© &quot;sangue&quot;, ent√£o a representa√ß√£o JSON, a ser gerada pela classe <code>ToJson</code> para esta amostra √© fornecida abaixo:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;fullUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;urn:uuid:transient-2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;resource&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;resourceType&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Specimen&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;meta&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;profile&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://www.saude.gov.br/fhir/r4/StructureDefinition/BRAmostraBiologica-1.0&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;coding&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;system&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://www.saude.gov.br/fhir/r4/CodeSystem/BRTipoAmostraGAL&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;code&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SGHEM&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A produ√ß√£o da representa√ß√£o JSON, para um dado recurso, pode ser realizada de v√°rias formas, desde um mapeamento de cada poss√≠vel amostra biol√≥gica para a estrutura correspondente, at√© o uso de uma biblioteca para esta finalidade, como a <a href="https://hapifhir.io/hapi-fhir/docs/introduction/introduction.html" target="_blank" rel="noopener noreferrer">HAPI FHIR</a>. Neste caso, cria-se uma inst√¢ncia da classe <code>Specimen</code> (<a href="https://hapifhir.io/hapi-fhir/apidocs/hapi-fhir-structures-r4/undefined/org/hl7/fhir/r4/model/Specimen.html" target="_blank" rel="noopener noreferrer">javadoc</a>) por meio do uso de m√©todos de &quot;alto n√≠vel&quot; (<em>fluent interface</em>) e a serializa√ß√£o em JSON pode ser usada por recurso da pr√≥pria biblioteca.</p><p>A classe <code>Empacotar</code> recebe os recursos serializados em JSON e os agrupa em um <em>Bundle</em>, que possui seus pr√≥prios atributos. O resultado abaixo omite o valor para <code>identifier</code> e os elementos do vetor <code>entry</code>, por simplicidade.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">&quot;resourceType&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Bundle&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;document&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">&quot;timestamp&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2020-03-20T00:00:00-03:00&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">&quot;meta&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;lastUpdated&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2020-03-20T00:00:00-03:00&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">&quot;identifier&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ... omitido ... </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">&quot;entry&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ... Resultado de Exame Laboratorial ... </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ... Diagn√≥stico em Laborat√≥rio Cl√≠nico ... </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ... Amostra Biol√≥gica ... </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Os exemplos JSON fornecidos acima s√£o parciais e
os detalhes est√£o dispon√≠veis no <a href="/rnds/docs/rel/mc-rel">Modelo Computacional</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="implementa√ß√£o"></a>Implementa√ß√£o<a class="hash-link" href="#implementa√ß√£o" title="Direct link to heading">#</a></h2><p>O <em>design</em> fornece uma orienta√ß√£o para o c√≥digo, mas ainda persistem op√ß√µes de implementa√ß√£o, algumas delas s√£o comentadas abaixo. Em vez de apresentar instru√ß√µes em uma dada linguagem de programa√ß√£o, detalhes t√©cnicos s√£o comentados.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conector-cliente-aws"></a>conector-cliente (aws)<a class="hash-link" href="#conector-cliente-aws" title="Direct link to heading">#</a></h3><p>A classe <code>Conector</code> deve encapsular a comunica√ß√£o do SIS com o Conector e, em um cen√°rio onde a nuvem da Amazon √© empregada, o microsservi√ßo Conector pode ser implementado por uma Lambda Function exposta por meio do servi√ßo API Gateway. Neste cen√°rio, a implementa√ß√£o do m√©todo <code>Conector.notificar(Resultado)</code> ter√° que fazer requisi√ß√µes <em>https</em> para o <em>endpoint</em> exposto pelo servi√ßo API Gateway, que ser√£o redirecionadas para a Lambda Function corresondente.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conector-cliente-arquivo"></a>conector-cliente (arquivo)<a class="hash-link" href="#conector-cliente-arquivo" title="Direct link to heading">#</a></h3><p>O laborat√≥rio que usa infraestrutura pr√≥pria e cujo SIS oferece recurso para exportar um laudo em documento XML, pode n√£o demandar manuten√ß√£o.
O diret√≥rio em que tais documentos s√£o depositados pode ser monitorado e, a cada novo arquivo, o m√©todo <code>Conector.notificar(Resultado)</code> deve iniciar o caso de uso <em>Enviar resultado de COVID</em>, ap√≥s a montagem do <em>payload</em>.</p><p>A op√ß√£o acima √© uma estrat√©gia amplamente empregada. A biblioteca <a href="https://www.npmjs.com/package/chokidar" target="_blank" rel="noopener noreferrer">Chokidar</a> √© uma evid√™ncia.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rnds-biblioteca"></a>rnds (biblioteca)<a class="hash-link" href="#rnds-biblioteca" title="Direct link to heading">#</a></h3><p>√Äs fun√ß√µes atribu√≠das a esta biblioteca s√£o bem espec√≠ficas e podem ser encapsuladas e reutilizadas. √â o que √© feito por meio de bibliotecas como a <a href="https://hapifhir.io/hapi-fhir/docs/introduction/introduction.html" target="_blank" rel="noopener noreferrer">HAPI FHIR</a> e <a href="https://www.npmjs.com/package/rnds" target="_blank" rel="noopener noreferrer">rnds</a>.</p><p>Enquanto as fun√ß√µes de suporte podem ser reutilizadas, as fun√ß√µes como filtrar e mapear, por exemplo, dependem do contexto espec√≠fico de cada estabelecimento de sa√∫de.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fun√ß√µes-espec√≠ficas-por-estabelecimento"></a>Fun√ß√µes espec√≠ficas por estabelecimento<a class="hash-link" href="#fun√ß√µes-espec√≠ficas-por-estabelecimento" title="Direct link to heading">#</a></h3><p>As estrat√©gias adotadas nas bibliotecas acima dificilmente podem ser replicadas na implementa√ß√£o das fun√ß√µes filtrar e mapear, por exemplo.</p><p>Quando um SIS √© capaz de exportar um documento XML pertinente a um resultado de exame, tem-se uma fun√ß√£o √∫til e que viabiliza o acr√©scimo do Conector sem necessidade de altera√ß√£o do SIS. Contudo, o esquema empregado pelo SIS, provavelmente, √© diferente daquele estabelecido pelo modelo computacional. Em consequ√™ncia, n√£o h√° como implementar uma fun√ß√£o <em>filtrar</em> de forma gen√©rica, que obtenha dados de um esquema desconhecido.</p><p>Em outro exemplo, a fun√ß√£o filtrar pode exigir consultas em um Banco de Dados relacional, e que s√£o naturalmente espec√≠ficas para o esquema em quest√£o.</p><p>Apesar de n√£o ser vi√°vel uma implementa√ß√£o que possa ser reutilizada, √© poss√≠vel indicar <a href="/rnds/docs/rnds/tecnologias">ferramentas</a> possivelmente relevantes para v√°rios cen√°rios.</p></div><footer class="row docusaurus-mt-lg"><div class="col"></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2021-02-07T14:14:15.000Z">2/7/2021</time></b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rnds/docs/introducao"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Introdu√ß√£o</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rnds/docs/publico-alvo/publico-alvo"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Quem? ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sistema-de-informa√ß√£o-em-sa√∫de-sis" class="table-of-contents__link">Sistema de Informa√ß√£o em Sa√∫de (SIS)</a><ul><li><a href="#sem-integra√ß√£o" class="table-of-contents__link">Sem integra√ß√£o</a></li><li><a href="#com-integra√ß√£o" class="table-of-contents__link">Com integra√ß√£o</a></li><li><a href="#design-do-conector-sem-restri√ß√µes" class="table-of-contents__link"><em>Design</em> do Conector (sem restri√ß√µes?)</a></li></ul></li><li><a href="#conector-de-refer√™ncia" class="table-of-contents__link">Conector de refer√™ncia</a><ul><li><a href="#escopo" class="table-of-contents__link">Escopo</a></li></ul></li><li><a href="#requisitos" class="table-of-contents__link">Requisitos</a><ul><li><a href="#fluxo-de-dados" class="table-of-contents__link">Fluxo de dados</a></li><li><a href="#casos-de-uso" class="table-of-contents__link">Casos de uso</a></li><li><a href="#obter-token-de-acesso" class="table-of-contents__link">Obter token de acesso</a></li><li><a href="#montar-payload-para-resultado-de-covid" class="table-of-contents__link">Montar payload para resultado de COVID</a></li><li><a href="#enviar-resultado-de-covid" class="table-of-contents__link">Enviar resultado de COVID</a></li></ul></li><li><a href="#design" class="table-of-contents__link">Design</a><ul><li><a href="#esbo√ßo-inicial" class="table-of-contents__link">Esbo√ßo inicial</a></li><li><a href="#esbo√ßo-resultante" class="table-of-contents__link">Esbo√ßo resultante</a></li></ul></li><li><a href="#implementa√ß√£o" class="table-of-contents__link">Implementa√ß√£o</a><ul><li><a href="#conector-cliente-aws" class="table-of-contents__link">conector-cliente (aws)</a></li><li><a href="#conector-cliente-arquivo" class="table-of-contents__link">conector-cliente (arquivo)</a></li><li><a href="#rnds-biblioteca" class="table-of-contents__link">rnds (biblioteca)</a></li><li><a href="#fun√ß√µes-espec√≠ficas-por-estabelecimento" class="table-of-contents__link">Fun√ß√µes espec√≠ficas por estabelecimento</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/rnds/assets/js/runtime~main.3303b8a6.js"></script>
<script src="/rnds/assets/js/main.feafc91e.js"></script>
</body>
</html>